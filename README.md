[![License](https://img.shields.io/badge/License-MIT%202.0-blue.svg)](https://opensource.org/licenses/MIt)
[![Maintenance](https://img.shields.io/badge/Maintained%3F-yes-blue.svg)](https://GitHub.com/zmahnoor14/MAW/graphs/commit-activity)
[![GitHub contributors](https://img.shields.io/github/contributors/zmahnoor14/MAW.svg)](https://GitHub.com/zmahnoor14/MAW/graphs/contributors/)
[![GitHub issues](https://img.shields.io/github/issues/zmahnoor14/MAW.svg)](https://GitHub.com/zmahnoor14/MAW/issues/)
[![DOI](https://zenodo.org/badge/438345970.svg)](https://zenodo.org/badge/latestdoi/438345970)

<p align="center"><img width="528" alt="MAW" src="https://user-images.githubusercontent.com/30716951/168855653-ae2efaa1-cbaf-4215-a04e-13bcd88ac46f.png"></p>


This repository hosts Metabolome Annotation Workflow (MAW). The workflow takes MS2 .mzML format data files as an input in R. It performs spectral database dereplication using R Package [Spectra](https://rformassspectrometry.github.io/Spectra/) and compound database dereplication using [SIRIUS](https://bio.informatik.uni-jena.de/software/sirius/). Final candidate selection is done in Python using [RDKit](https://www.rdkit.org/) and [PubChemPy](https://pubchempy.readthedocs.io/en/latest/).The classification of the tentative candidates from the input data are classified using [CANOPUS](https://bio.informatik.uni-jena.de/software/canopus/) and [ClassyFire](http://classyfire.wishartlab.com/).

## Install MAW

Install Docker on your [MAC OS](https://www.docker.com/get-started/) OR on [Linux](https://docs.docker.com/engine/install/ubuntu/). <br>

Since MAW is implemented in R and Python so we have two separate Docker images. 

### Pull maw-r Docker Image
To pull MAW-R R-docker image, run the following command on your terminal:
```
docker pull zmahnoor/maw-r:1.0.1
```
This will creat a R-Docker image on your system. This image contains /opt/workdir as the working directory which contains the following files and folders:
<br>
1. /data (folder)
2. /data/example_Tyrosine.mzML
3. /data/hmdb.rda
4. /data/gnps.rda
5. /data/mbankNIST.rda
6. Workflow_R_Functions.r (R function script)
7. Workflow_R_Script.r (R example script)


### Pull maw-sirius5 Docker Image
To pull MAW-SIRIU5 R-docker image, run the following command on your terminal:
```
docker pull zmahnoor/maw-sirius5-old --platform=linux/amd64
```
This will creat a R-Docker image on your system. This image contains /opt/workdir as the working directory which contains the following files and folders:
<br>
1. /data (folder)
2. /data/insilico/MS1DATA_SiriusP.tsv (example file containing list of ms inputs and json output file paths)
3. /data/insilico/SIRIUS/1_NA_iso_NA_MS1p_204.122756958008_SIRIUS_param.ms (example file for .ms input file for SIRIUS)
4. /data/Run_SIRIUS5.r (running Sirius5 script) <br>

### Pull maw-py Docker Image
To pull MAW-Py Python-docker image, run the following command on your terminal:
```
docker pull zmahnoor/maw-py:1.0.0
```
This will creat a R-Docker image on your system. This image contains /opt/workdir as the working directory which contains the following files and folders:
1. /data (folder) 
2. /data/example_Tyrosine/ (result folder generated by MAW-R)
3. /data/hmdb_dframe_str.csv
4. Workflow_Python_Functions.py (Python function script)
5. Workflow_Python_Script.py (Python example script)
6. requirements.txt (Python package installation script, these pacakges are already installed the docker container) <br>

## Use Case

### 1. First Run maw-r:

```
docker run --name example_maw-r -i -t zmahnoor/maw-r:1.0.0 /bin/bash
```
Once you enter the docker container, you can run the script and check the results.
```
Rscript --no-save --no-restore --verbose Workflow_R_Script.r >outputFile.txt 2>&1
```
This command will run the Workflow_R_Script.r which is an example script for /data/example_Tyrosine.mzML. The calculation takes about 2 minutes on an Ubuntu system with 64GB RAM.

### [NEW] 2. Updated with SIRIUS5

SIRIUS version 5 can be used using another docker container made for SIRIUS5. to run this, it is important athat you alsready have .md files in the SIRIUS folder generated from the MAW-R part of the workflow in the correct order of directory. Also, you would need to add your SIRIUS credentials after you enter the docker container. THere is an R script called Run_SIRIUS5.r which contains the libraries, the function to run SIRIUS5 from R and a function call with your data. 

```R
run_sirius(files= './insilico/MS1DATA_SiriusP.tsv',
           ppm_max = 5, 
           ppm_max_ms2 = 15, 
           QC = FALSE, 
           SL = FALSE, 
           SL_path = NA, 
           candidates = 30, 
           profile = "orbitrap", 
           db = "coconut")
```

Please check the R script and make the changes in the parameters above according to your data needs. SL means suspect list but this function is currently being updated by SIRIUS5 and shoulbe kept ```FALSE```. profile can be the mass spectrometer used, either "orbitrap" or "qtof". db can be "ALL", "bio", "coconut" or any relevant database that is already provided by SIRIUS5. Also, for files, provide the full path of your './insilico/MS1DATA_SiriusP.tsv'. Run the function for each of your input files.

Enter docker container:
```
docker run --platform linux/x86_64 -i -t zmahnoor/maw-sirius5-old /bin/bash
```

Enter login info:

```
sirius login -u user@email.com -p --show
```
Th prompt will ask for your password, so enter the pssowrd and hit enter.

```
cd /data
Rscript --no-save --no-restore --verbose Run_SIRIUS5.r >outputFile.txt 2>&1
```

### 3. Run maw-py
```
docker run --name example_maw-py -i -t zmahnoor/maw-py:1.0.0 /bin/bash
```
Once you enter the docker container, you can run the script and check the results.
```
python3 Workflow_Python_Script.py
```
This command will run the Workflow_Python_Script.py which is an example script for /data/Example_Tyrosine/ obtained earlier with MAW-R. In order to leave the container without killing the process, add $ at the end of commands inside of the container. Then disown the PID and leave the container with CTRL+P and CTRL+Q. <br>

The results can be seen in the /data/final_candidates.csv.
<br>

> **Note**
> For details on using the workflow on Jupyter notebooks in a more interactive mode, please follow the Tutorial part on wiki page of this repository

## Citation
Zulfiqar, M., Gadelha, L., Steinbeck, C., Sorokina, M., & Peters, K. (2022). Metabolome Annotation Workflow (MAW) (Version 1.0.0) [Computer software]. https://doi.org/10.5281/zenodo.7148450

## More information about our research group

[![GitHub Logo](https://github.com/Kohulan/DECIMER-Image-to-SMILES/blob/master/assets/CheminfGit.png?raw=true)](https://cheminf.uni-jena.de)
